---
Keywords: 日記, 自作シェル
Copyright: (C) 2023 Ryuichi Ueda
---

# 日記（2023年11月11日）

　査読ばっかりで、あまりにも査読したくなくてこれを記しております。

## シェル芸勉強会

12月16日やります！スケジュールと墓穴を開けて待っててください！たぶん都内某所です。

## Rustでクレートを使ってシグナルを非同期で受けようとするとファイル記述子を使いやがる

　最近の一番の悩みで、[ctrlc](https://crates.io/crates/ctrlc)を使っても、[signal-hook](https://crates.io/crates/signal-hook)を使っても、非同期処理でパイプやソケットを使ってしまうため、3番や4番のファイル記述子を使ってしまいます。[シェルを作っているのに](/page=sd_rusty_bash)、そんな若い番号のファイル記述子を勝手に使ってもらっては困るんですが、ほかによい方法が見つかりません。たぶん`main`に入ってすぐに3〜9を使い潰してからスレッドを動かして、3〜9を閉じればなんとかなりそうですが、それでもユーザーの知らないファイル記述子が`/proc/$$/fd`の下に見えたら嫌なわけで、どうしようかと。Rustだとどうしてもそうしないとだめなんですかね？

　一応、[これが](https://github.com/shellgei/rusty_bash/blob/sd/202405_async/src/main.rs)連載で作っているシェルを`SIGCHLD`に非同期で反応できるようにしたバージョンへのリンクです（正確には`main.rs`へのリンクで、ここに`SIGCHLD`を待っている記述があります。）。なにかピンと来たらご一報を。

### 追記

　先人が全く同じことで悩まれておりました。後追いで似たことをしてしまっておりいつも恐縮しておりますです。

* reddish-shell v0.11.0-beta4 開発進捗 | パイプライン、バックグラウンド実行、コマンド置換の実装 | ぶていのログでぶログ: https://tech.buty4649.net/entry/2021/11/11/000845

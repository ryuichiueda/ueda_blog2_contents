---
Keywords: 日記, 自作シェル
Copyright: (C) 2023 Ryuichi Ueda
---

# 日記（2023年11月11日）

　査読ばっかりで、あまりにも査読したくなくてこれを記しております。

## Rustでクレートを使ってシグナルを非同期で受けようとするとファイル記述子を使いやがる

　最近の一番の悩みで、[ctrlc](https://crates.io/crates/ctrlc)を使っても、[signal-hook](https://crates.io/crates/signal-hook)を使っても、非同期処理でパイプやソケットを使ってしまうため、3番や4番のファイル記述子を使ってしまいます。[シェルを作っているのに](/page=sd_rusty_bash)、そんな若い番号のファイル記述子を勝手に使ってもらっては困るんですが、ほかによい方法が見つかりません。たぶん`main`に入ってすぐに3〜9を使い潰してからスレッドを動かして、3〜9を閉じればなんとかなりそうですが、それでもユーザーの知らないファイル記述子が`/proc/$$/fd`の下に見えたら嫌なわけで、どうしようかと。Rustだとどうしてもそうしないとだめなんですかね？

---
Keywords: 自作シェル,rusty_bash,寿司シェル
Copyright: (C) 2025 Ryuichi Ueda
---

# 自作シェルの進捗（2025年3月29日その2）

　[前の記事](/?post=20250329)の続きです。前の記事のとおり、
Bashの公式リポジトリのテストを使い始めました。しかしこのテスト、
エッジケースが多い上にテストスクリプト自体が
bash-completion並みに変態なので、
それに対応せねばならずいろいろ調べてました。

## Bashではfunctionと書けば`()`が省略できる

テストスクリプトを自作シェルに読み込ませると
「`function`なんてコマンドねえよ」
（=`function`というキーワードで始まると、
関数の定義部分が認識できない）
というエラーが出たのでおかいしなあと色々調べてたんですが、
テストスクリプトの当該のところを見たら関数の定義に`()`
がついてません。

@@@

どうやら`function`と明示的に書いて関数を定義すると
`()`が要らんようです。確かにシェルの関数の`()`
はなんの意味もない飾りなので合理的ではあるけど、
そんなこと知るか。

ということで自作シェルも`()`なしで大丈夫なように直しました。

そんなこと知るか（重要でないけど2回言う）。


## Bashのglobstarは同じパスを何回も出す

Bashで`shopt -s globstar`を実行すると、
ファイルグロブ（ワイルドカード）で`**`
という表現が使えるようになります。
これはあるディレクトリの階層で`echo ./**`みたいに使うと、
それ以下にあるファイルやディレクトリのパスを
すべて列挙できるという機能です。

で、自作シェルでは辛いので実装を後回しにしてたのですが、
Bashの公式テストに叱られるので実装しました。


ビビってた割には簡単に実装できたのですが、
うまく動いているはずなのになぜかテストが通りません。
で、テストの正解を見たりBashの挙動を調べたりしていたところ、
Bashが同じパスを何回も出力しているのを発見しました。

@@@

そんなこと知るか（3回目）。

テストスクリプトにこう書いてあるので

@@@

kshに互換性を持たせているか、
同じ実装になっているようなのですが、



### IFS地獄
